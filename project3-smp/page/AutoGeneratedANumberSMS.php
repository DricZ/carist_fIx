

<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Responsive Bootstrap 4 Admin &amp; Dashboard Template">
	<meta name="author" content="Bootlab">
	<link rel="icon" href="favicon.ico">

	<title>BlastMe Admin Page | Send SMS with auto generated A Numbers</title>
	
	<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
	
	<link href="../css/app.css" rel="stylesheet">
</head>
<body>
	
	<div class="splash active">
		<div class="splash-icon"></div>
	</div>

	<nav class="navbar navbar-expand navbar-dark bg-dark">
		<div class="container">
			<a class="navbar-brand" href="/index.php">
				<img src="../assets/test.png" alt="NeuAPIX" class="img-fluid" width="200" height="200"/><br>
      		</a>

			<div class="navbar-collapse collapse">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item dropdown ml-lg-2">
						<a class="nav-link dropdown-toggle" href="#" id="userDropdown" data-toggle="dropdown">
							<span class="d-none d-lg-inline-block">User</span>
							<span class="d-lg-none"><i class="align-middle fas fa-cog"></i></span>
            			</a>
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
							<a class="dropdown-item" href="../index.php"><i class="align-middle mr-1 fas fa-fw fa-arrow-alt-circle-right"></i> Sign out</a>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	
	<div class="header">
		<div class="container">
			<div class="media text-white">
				<div class="media-body">
					<span class=" font-weight-normal">(JUDUL)</span>
				</div>
			</div>
		</div>
	</div>


	<main class="content">
		<div class="container">
			<div class="row">
				<div class="col-12 col-md-4 col-lg-3 col-xl-2">
    <a class="card d-block d-md-none mt-4" data-toggle="collapse" data-target="#sidebar">
        <div class="card-header">
            <h5 class="card-title mb-0">Menu</h5>
        </div>
    </a>

    <nav id="sidebar" class="collapse collapse-disabled-md sidebar sidebar-sticky">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Transaction</h5>
            </div>
            <div class="sidebar-content">
                <a href="../dashboard.php?j=801fbf1916c335d616903bf6c6710fea434254a0" class="sidebar-item">
                    <i class="align-middle mr-1 fas fa-fw fa-home"></i> <span class="align-middle">Dashboard</span>
                </a>
                <a class="sidebar-item" href="#transaction" data-toggle="collapse">
                    <i class="align-middle mr-1 fas fa-fw fa-desktop"></i> <span class="align-middle">Transaction</span>
                </a>
                <div class="sidebar-dropdown collapse" id="transaction" data-parent="#sidebar">
                    <a class="sidebar-item" href="./SMSTransactionReport.php?j=801fbf1916c335d616903bf6c6710fea434254a0" >Transaction Report</a>
                </div>
                <div class="sidebar-dropdown collapse" id="transaction" data-parent="#sidebar">
                    <a class="sidebar-item" href="./CSVTransactionReports.php?j=801fbf1916c335d616903bf6c6710fea434254a0" >Generated CSV Report</a>
                </div>
            </div>
        </div>

        
        
        
        	<div class="card">		<div class="card-header">			<h5 class="card-title mb-0">Sending</h5>		</div>		<div class="sidebar-content">			<a class="sidebar-item" href="#sendingsms" data-toggle="collapse">			<i class="align-middle mr-1 fas fa-fw fa-desktop"></i> <span class="align-middle">Sending SMS</span>			</a>			<div class="sidebar-dropdown collapse" id="sendingsms" data-parent="#sidebar">				<a class="sidebar-item" href="./AutoGeneratedANumberSMS.php?j=801fbf1916c335d616903bf6c6710fea434254a0">Auto Generated A Number</a>			</div>		</div>	</div>

        
        
        
    </nav>
</div>

				<div class="col-12 col-md-8 col-lg-9 col-xl-10 pl-lg-4">
					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-header">
									<h5 class="card-title mb-0">Sending SMS with Auto Generated Sender ID</h5>
								</div>
								<div class="card-body">									
									<div class="col-12 col-xl-12">
										<div class="card">
											<div class="card-header">
												<h5 class="card-title">Auto Generated Sender IDs SMS</h5>
											</div>
											
											<div class="row">
												<div class="col-12">
													<input type="hidden" id="uuid" name="uuid">
													<input type="hidden" id="step01" name="step01">
													<input type="hidden" id="step02" name="step02">
													<input type="hidden" id="step03" name="step03">
													<input type="hidden" id="step04" name="step04">
													<input type="hidden" id="counter" name="counter">
													<input type="hidden" id="dMessage" name="dMessage">
													<input type="hidden" id="fileName" name="fileName">
													<input type="hidden" id="numberOfSMS" name="numberOfSMS">  													
													<div id="smartwizard-arrows-danger" class="wizard wizard-danger mb-4">
														<ul>
															<li><a href="#arrows-danger-step-1">Upload B#</a></li>
															<li><a href="#arrows-danger-step-2">Generate A#</a></li>
															<li><a href="#arrows-danger-step-3">Write Your Message</a></li>
														</ul>

														<div>
															<div id="arrows-danger-step-1" class="">
																<div class="row">
																	<div class="col-12">
																		<form>
																			<div class="form-group">
																				<div id="divUUID01">
																				</div>
																			</div>
																			<div class="form-group">
																				<div class="custom-file">
																					<input type="file" class="custom-file-input" id="validatedCustomFile" name="validatedCustomFile" required>
																					<label class="custom-file-label" for="validatedCustomFile" id="labelCustomFile" name="labelCustomFile">Choose B# number file.</label>
																				</div>
																			</div>

																			<div class="form-group">
																				<button class="btn mb-1 btn-bitbucket" id="buttonUpload" name="buttonUpload"><i class="align-middle fas fa-address-book"></i> Upload</button>
																			</div>
																		</form>																			
																	</div>
																</div>

																<div class= "row">
																	<div class="col-12">
																		<div id="uploadConfirmation">

																		</div>
																	</div>
																</div>

																<div class="row">
																	<div class="col-12">

<br><h4><u>Uploading B Numbers List</u></h4>
<p>Put your B Numbers list into text file (.txt), line by line. Each one line will be considered as one B Number. Do not put any space in one line. <a href="/page/DownloadFile.php?file=tempBNumber-&j=801fbf1916c335d616903bf6c6710fea434254a0" target="_blank">Click HERE</a> to get one of the BNumber List template file.</p>

<p>After you fill in the BNumber list, upload your file by clicking button "Browse" above or any where inside text box "Choose B# number file", then click button "Upload".</p>

<p>Confirmation text-box will appear as soon as button "Upload" pressed. If uploaded list has more than 200 lines, it will be previewed first 200 lines only.
</p>		
				
																		
																	</div>
																</div>
															</div>

															<div id="arrows-danger-step-2" class="">
																<div class="row">
																	<div class="col-12">
																		<form>
																			<div class="form-group">
																				<div id="divUUID02">
																				</div>
																			</div>

																			<div class="form-group">
																				<label class="col-form-label">Country Code</label>
																				<div>
																					<select class="form-control" id="CountryCode" name="CountryCode">
																						<option value="62" selected>62 - Indonesia</option>
                   <option value="66">66 - Thailand</option>

																						<option value="65">65 - Singapore</option>
<!--																						<option value="86">86 - China</option>-->
																						<option value="60">60 - Malaysia</option>
																						<option value="852">852 - Hongkong</option>
<!--																						<option value="66">66 - Thailand</option>-->
<!--																						<option value="95">95 - Myanmar</option>-->
<!--																						<option value="84">84 - Vietnam</option>-->
																						<option value="63">63 - Philippines</option>
<!--																						<option value="855">855 - Cambodia</option>-->
<!--																						<option value="856">856 - Laos</option>-->
<!--                                                                                        <option value="1">1 - US</option>-->
																					</select>
																				</div>									
																			</div>	
																			<div class="form-group">
																				<button class="btn mb-1 btn-bitbucket" id="buttonGenerateANumber" name="buttonGenerateANumber"><i class="align-middle fas fa-th-list"></i> Generate A Number</button>
																			</div>	
																		</form>
																	</div>
																</div>
																
																<div class= "row">
																	<div class="col-12">
																		<div id="aNumberConfirmation">

																		</div>
																	</div>
																</div>
																
																<div class= "row">
																	<div class="col-12">
<h4><u>Generate A#</u></h4>
<p>A Number is your origin phone number. It is auto-generated by application as many as the B Number uploaded in previous step.</p>

<p>For it is auto-generated, you can not choose it, but you can choose the country code and review it. It the A Number is more than 100, it will only previewed 100 lines only.</p>
																		
																	</div>
																</div>
															</div>

															<div id="arrows-danger-step-3" class="">
																<form>
																	<div class="form-group">
																		<div id="divUUID03">
																		</div>
																	</div>
																	<div class="form-group">
																		<label class="form-label">Select your message encoding</label>
																		<select class="form-control" id="msgEncoding" name="msgEncoding">
																			<option value="GSM7">GSM7</option>
																			<option value="UCS2" selected>UCS2</option>
																		</select>
																	</div>
																
																	<div class="form-group">
																		<label class="form-label">Write your message here</label>
																		
																		<div class="clearfix">
																			<div id="quill-toolbar">
																			</div>
																			<div id="quill-editor"></div>
																		</div>
																	</div>
																
																	<div id="divMessageLength">
																	
																	</div>
																	
																	<div class="form-group">
																		<button class="btn mb-1 btn-bitbucket" id="saveMessage" name="saveMessage"><i class="align-middle fas fa-save"></i> Save & Send Message</button>
																	</div>

<h3><u>Writing Message</u></h3>

<p>One thing to consider seriously when writing the message is the encoding to use. GSM7 supports standard alphabet, UCS2 supports almost all traditional characters like Simplified Chinese and so on. Encoing will affect on the message length. If message length is more than 160 charactersfor GSM 7 and 70 characters for UCS2, it will become multipart message.</p>
																	
<h3><u>Message Length Guidance</u></h3>

<h3>GSM7 encoding</h3>

<p>This is the most commonly used encoding for messages with 	<a title="http://en.wikipedia.org/wiki/GSM_03.38" href="http://en.wikipedia.org/wiki/GSM_03.38" target="_blank">GSM 03.38</a> 	character set. In this 7-bit alphabet you can use only following characters:</p>

<div style="margin-bottom: 10px;" class="sms-part">	<span title="commercial at" class="c7b">@</span> 	<span title="Greek capital Delta" class="c7b">Δ</span> 	<span class="c7b">SP</span> 	<span class="c7b">0</span> 	<span title="inverted exclamation mark" class="c7b">¡</span> 	<span class="c7b">P</span> 	<span title="inverted question mark" class="c7b">¿</span> 	<span class="c7b">p</span> 	<span title="pound symbol" class="c7b">£</span> 	<span title="underscore" class="c7b">_</span> 	<span title="exclamation mark" class="c7b">!</span> 	<span class="c7b">1</span> 	<span class="c7b">A</span> 	<span class="c7b">Q</span> 	<span class="c7b">a</span> 	<span class="c7b">q</span> 	<span title="dollar symbol" class="c7b">$</span> 	<span title="Greek capital Phi" class="c7b">Φ</span> 	<span title="double quote" class="c7b">"</span> 	<span class="c7b">2</span> 	<span class="c7b">B</span> 	<span class="c7b">R</span> 	<span class="c7b">b</span> 	<span class="c7b">r</span> 	<span title="yen symbol" class="c7b">¥</span> 	<span title="Greek capital Gamma" class="c7b">Γ</span> 	<span title="number sign" class="c7b">#</span> 	<span class="c7b">3</span> 	<span class="c7b">C</span> 	<span class="c7b">S</span> 	<span class="c7b">c</span> 	<span class="c7b">s</span> 	<span title="Latin small letter e with grave" class="c7b">è</span> 	<span title="Greek capital Lambda" class="c7b">Λ</span> 	<span title="currency symbol" class="c7b">¤</span> 	<span class="c7b">4</span> 	<span class="c7b">D</span> 	<span class="c7b">T</span> 	<span class="c7b">d</span> 	<span class="c7b">t</span> 	<span title="Latin small letter e with acute" class="c7b">é</span> 	<span title="Greek capital Omega" class="c7b">Ω</span> 	<span title="percent sign" class="c7b">%</span> 	<span class="c7b">5</span> 	<span class="c7b">E</span> 	<span class="c7b">U</span> 	<span class="c7b">e</span> 	<span class="c7b">u</span> 	<span title="Latin small letter u with grave" class="c7b">ù</span> 	<span title="Greek capital Pi" class="c7b">Π</span> 	<span title="ampersand" class="c7b">&amp;</span> 	<span class="c7b">6</span> 	<span class="c7b">F</span> 	<span class="c7b">V</span> 	<span class="c7b">f</span> 	<span class="c7b">v</span> 	<span title="Latin small letter i with grave" class="c7b">ì</span> 	<span title="Greek capital Psi" class="c7b">Ψ</span> 	<span title="apostrophe-quote" class="c7b">'</span> 	<span class="c7b">7</span> 	<span class="c7b">G</span> 	<span class="c7b">W</span> 	<span class="c7b">g</span> 	<span class="c7b">w</span> 	<span title="Latin small letter o with grave" class="c7b">ò</span> 	<span title="Greek capital Sigma" class="c7b">Σ</span> 	<span title="opening parenthesis" class="c7b">(</span> 	<span class="c7b">8</span> 	<span class="c7b">H</span> 	<span class="c7b">X</span> 	<span class="c7b">h</span> 	<span class="c7b">x</span> 	<span title="Latin capital letter C with cedilla" class="c7b">Ç</span> 	<span title="Greek capital Theta" class="c7b">Θ</span> 	<span title="closing parenthesis" class="c7b">)</span> 	<span class="c7b">9</span> 	<span class="c7b">I</span> 	<span class="c7b">Y</span> 	<span class="c7b">i</span> 	<span class="c7b">y</span> 	<span class="c7b">LF</span> 	<span title="Greek capital Xi" class="c7b">Ξ</span> 	<span title="asterisk" class="c7b">*</span> 	<span title="colon" class="c7b">:</span> 	<span class="c7b">J</span> 	<span class="c7b">Z</span> 	<span class="c7b">j</span> 	<span class="c7b">z</span> 	<span title="Latin capital letter O with stroke" class="c7b">Ø</span> 	<span class="c7eb" style="background-color: rgb(255, 238, 170);">ESC</span> 	<span title="plus sign" class="c7b">+</span> 	<span title="semicolon" class="c7b">;</span> 	<span class="c7b">K</span> 	<span title="Latin capital letter A with diaeresis" class="c7b">Ä</span> 	<span class="c7b">k</span> 	<span title="Latin small letter a with diaeresis" class="c7b">ä</span> 	<span title="Latin small letter o with stroke" class="c7b">ø</span> 	<span title="Latin capital letter AE" class="c7b">Æ</span> 	<span title="comma" class="c7b">,</span> 	<span title="less-than sign" class="c7b">&lt;</span> 	<span class="c7b">L</span> 	<span title="Latin capital letter O with diaeresis" class="c7b">Ö</span> 	<span class="c7b">l</span> 	<span title="Latin small letter o with diaeresis" class="c7b">ö</span> 	<span class="c7b">CR</span> 	<span title="Latin small letter ae" class="c7b">æ</span> 	<span title="minus-hyphen" class="c7b">-</span> 	<span title="equals sign" class="c7b">=</span> 	<span class="c7b">M</span> 	<span title="Latin capital letter N with tilde" class="c7b">Ñ</span> 	<span class="c7b">m</span> 	<span title="Latin small letter n with tilde" class="c7b">ñ</span> 	<span title="Latin capital letter A with ring" class="c7b">Å</span> 	<span title="Latin small letter sharp s" class="c7b">ß</span> 	<span title="full stop" class="c7b">.</span> 	<span title="greater-than sign" class="c7b">&gt;</span> 	<span class="c7b">N</span> 	<span title="Latin capital letter U with diaeresis" class="c7b">Ü</span> 	<span class="c7b">n</span> 	<span title="Latin small letter u with diaeresis" class="c7b">ü</span> 	<span title="Latin small letter a with ring" class="c7b">å</span> 	<span title="Latin capital letter E with acute" class="c7b">É</span> 	<span title="solidus" class="c7b">/</span> 	<span title="question mark" class="c7b">?</span> 	<span class="c7b">O</span> 	<span title="section sign" class="c7b">§</span> 	<span class="c7b">o</span> 	<span title="Latin small letter a with grave" class="c7b">à</span>
</div>

<p>There are also some characters in the&nbsp;GSM 03.38 Extension Table that can be used for the 	<strong>cost of two characters</strong> by prepending escape character <span style="background-color: rgb(255, 238, 170);">ESC</span>&nbsp;(0x1B):</p>

<table>
	<tbody>
	<tr>
		<td>|</td>
		<td>^</td>
		<td>€</td>
		<td>{</td>
		<td>}</td>
		<td>[</td>
		<td>]</td>
		<td>~</td>
	</tr>
	</tbody>
</table>

<p>The message length for 7bit encoding is up to <b>160 characters</b>.</p>

<h3>Unicode Encoding</h3>

<p>Unicode (UCS-2) encoding supports a great range of characters and languages compared to the very limited alphabet of 7bit encoding.</p>

<p>If your message contains any characters not listed in the 7-bit alphabet, UCS-2 encoding is automatically used. 	In this case, each message takes up a lot more space, thus the message length is reduced to <b>70 characters</b>.</p>

<h3>Multipart SMS messages</h3>

<p>When the message length sent through an SMS API, for example, exceeds the SMS character limit of 160 characters in case of 7bit encoding (or 70 characters for UCS-2 encoding), 	the message is split up to multiple separate SMS and sent to the handset separately as well. So, it's important to use this calculator to make sure that you don't exceed the limit and pay more than you planned.<br>

<p>To be able to concentrate the messages on the phone, special header (<a title="http://en.wikipedia.org/wiki/User_Data_Header" href="http://en.wikipedia.org/wiki/User_Data_Header" target="_blank">UDH</a>) is set for each message, which states the order and message each part belongs to. Due to this special UDH, the length of each combined 7-bit message is shortened to 152 characters (66 characters for UCS-2).</p>											

<table class="table table-striped">
	<thead>
	<tr>
		<td><br></td>
		<td><b>Regular SMS</b></td>
		<td><b>Multipart SMS</b></td>
	</tr>
	</thead>
	<tbody>
	<tr>
		<td>7-bit</td>
		<td>160 chars</td>
		<td>152 chars</td>
	</tr>
	<tr>
		<td>Unicode</td>
		<td>70 chars</td>
		<td>66 chars</td>
	</tr>
	</tbody>
</table>
																	
																</form>
															</div>
														</div>
													</div>												
												</div>					
											</div>
										</div>
									</div>
									
									<div class="modal fade" id="sendingConfirmation" tabindex="-1" role="dialog" aria-hidden="true">
										<div class="modal-dialog" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title">Sending Confirmation</h5>
													<button type="button" class="close" data-dismiss="modal" aria-label="Close">
														<span aria-hidden="true">&times;</span>
													</button>
												</div>
												<div class="modal-body m-3">
													<form>
														<div class="form-group row">
															<label>A Numbers and B Numbers</label>
															<textarea class="form-control" rows="15" id="ABNumberList" name="ABNumberList" disabled></textarea>
														</div>
														<div class="form-group row">
															<label>Message</label>
															<textarea class="form-control" rows="5" id="SentMessage" name="SentMessage" disabled></textarea>
														</div>
														<div class="form-group row">
															<label>Message Length and Number per sending</label>
															<textarea class="form-control" rows="5" id="PropMessage" name="PropMessage" disabled></textarea>
														</div>
													</form>
												</div>

												<div class="modal-footer">
													<button type="button" class="btn btn-primary" name="btnSendTheMessage" id="btnSendTheMessage" data-dismiss="modal">Send The Message</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
	
	
	
		<footer class="footer">
		<div class="container">
			<hr />
			<div class="text-muted">
				<div class="row text-center justify-content-center align-self-center align-items-end">
						Provided  By &nbsp;<a href="https://www.telin.net/neuapix"><img src="../assets/test.png" alt="NeuAPIX" class="img-fluid" width="100" height="40"/></a>						
				</div>
			</div>
		</div>
	</footer>
	
	<script src="../js/app.js"></script>

	<svg width="0" height="0" style="position:absolute">
    <defs>
      <symbol viewBox="0 0 512 512" id="ion-ios-pulse-strong"><path d="M448 273.001c-21.27 0-39.296 13.999-45.596 32.999h-38.857l-28.361-85.417a15.999 15.999 0 0 0-15.183-10.956c-.112 0-.224 0-.335.004a15.997 15.997 0 0 0-15.049 11.588l-44.484 155.262-52.353-314.108C206.535 54.893 200.333 48 192 48s-13.693 5.776-15.525 13.135L115.496 306H16v31.999h112c7.348 0 13.75-5.003 15.525-12.134l45.368-182.177 51.324 307.94c1.229 7.377 7.397 11.92 14.864 12.344.308.018.614.028.919.028 7.097 0 13.406-3.701 15.381-10.594l49.744-173.617 15.689 47.252A16.001 16.001 0 0 0 352 337.999h51.108C409.973 355.999 427.477 369 448 369c26.511 0 48-22.492 48-49 0-26.509-21.489-46.999-48-46.999z"></path></symbol>
    </defs>
 	</svg>

	<script>
		$(document).ready(function(){
			var uuid = "6203cd522cc10-6203ceab47a23";
			console.log('uuid: ' + uuid);
			$('#uuid').val(uuid);
	
			// divUUID
			$('#divUUID01').html('<span style="font-size:14px;color:#EA4335">Batch ID: <b>' + $('#uuid').val() + '</b></span>');
			$('#divUUID02').html('<span style="font-size:14px;color:#EA4335">Batch ID: <b>' + $('#uuid').val() + '</b></span>');
			$('#divUUID03').html('<span style="font-size:14px;color:#EA4335">Batch ID: <b>' + $('#uuid').val() + '</b></span>');
			$('#divUUID04').html('<span style="font-size:14px;color:#EA4335">Batch ID: <b>' + $('#uuid').val() + '</b></span>');
			
  			$('[data-tooltip="tooltip"]').tooltip();   
			
			// Default, smartwizard 1 - 3 didisabled
			$('#smartwizard-arrows-danger').smartWizard("stepState", [1], "disable");
			$('#smartwizard-arrows-danger').smartWizard("stepState", [2], "disable");
			$('#smartwizard-arrows-danger').smartWizard("stepState", [3], "disable");
			
			var editor = new Quill('#quill-editor', {
				modules: {
					toolbar: '#quill-toolbar'
				},
				placeholder: 'Write your message here ..',
				theme: 'snow'
			});

			function isGSMAlphabet(text) {
    			var regexp = new RegExp("^[A-Za-z0-9 \\r\\n@£$¥èéùìòÇØøÅå\u0394_\u03A6\u0393\u039B\u03A9\u03A0\u03A8\u03A3\u0398\u039EÆæßÉ!\"#$%&'()*+,\\-./:;<=>?¡ÄÖÑÜ§¿äöñüà^{}\\\\\\[~\\]|\u20AC]*$");

    			return regexp.test(text);
			}
			
			function getLengthGSM7(theMessage){
				// Manage the message Length
				//var messageLength = editor.getText().trim().length;
				var messageLength = 0;
				
				// If contain char  |	^	€	{	}	[	]	~ \ count as 2 chars for it is using escape char
				for(var x = 0; x < theMessage.length; x++){
					if(theMessage.charAt(x) === '/'){
						messageLength = messageLength + 2;
					} else if(theMessage.charAt(x) === '^'){
						messageLength = messageLength + 2;
					} else if(theMessage.charAt(x) === '€'){
						messageLength = messageLength + 2;
					} else if(theMessage.charAt(x) === '{'){
						messageLength = messageLength + 2;
					} else if(theMessage.charAt(x) === '}'){
						messageLength = messageLength + 2;
					} else if(theMessage.charAt(x) === '['){
						messageLength = messageLength + 2;
					} else if(theMessage.charAt(x) === ']'){
						messageLength = messageLength + 2;
					} else if(theMessage.charAt(x) === '~'){
						messageLength = messageLength + 2;
					} else if(theMessage.charAt(x) === '\\'){
						messageLength = messageLength + 2;
					} else {
						messageLength = messageLength + 1;
					}
				}
				
				return messageLength;
			}
			
			editor.on('text-change', function(delta, oldDelta, source) {
				console.log('Message: ' + editor.getText());
				console.log('isGSMAlphabet: ' + isGSMAlphabet(editor.getText()));
				console.log('selectedMsgEncoding: ' + $('#msgEncoding').val());
				
				var theText = editor.getText().trim();
				
				if($('#msgEncoding').val() === 'GSM7'){
					var isGSMA = isGSMAlphabet(theText);
					if(isGSMA === false){
						alert("Your text is NOT GSM7 Character. Please use UCS2 instead.");
						
						// Reset all the text to empty
						editor.deleteText(0, editor.getLength(), "api");
					}
				} else if($('#msgEncoding').val() === 'UCS2'){
					
				}
				
				var messageLength = getLengthGSM7(editor.getText().trim());				
				var numberOfSMS = Math.ceil(messageLength / 66); // Default
				console.log('messageLength: ' + messageLength + ', numberOfSMS: ' + numberOfSMS);

				if($('#msgEncoding').val() === 'GSM7'){
					if(messageLength <= 160){
						// Masih satu karakter
						numberOfSMS = 1;
					} else {
						numberOfSMS = Math.ceil(messageLength / 152); // segment kalo GSM7 lebih dari 170, akan dipecah per 153 segement
					}
				} else if($('#msgEncoding').val() === 'UCS2'){
					if(messageLength <= 70){
						numberOfSMS = 1;
					} else {
						numberOfSMS = Math.ceil(messageLength / 66); // segment kalo UCS2 lebih dari 70, akan dipecah per 67 segement
					}
				}
				console.log('messageLength: ' + messageLength + ', numberOfSMS: ' + numberOfSMS);
				$('#numberOfSMS').val(numberOfSMS);

				// Cut text per limit max 2 sms
				var limit = 70;
				if($('#msgEncoding').val() === 'UCS2'){
					limit = 70;
				} else if($('#msgEncoding').val() === 'GSM7'){
					limit = 160;
				}
				
				if(editor.getLength() > limit){
					editor.deleteText(limit, editor.getLength(), "api");
					alert('Maximum sms is ' + limit + ' characters.');
					messageLength = getLengthGSM7(editor.getText().trim());
					if($('#msgEncoding').val() === 'GSM7'){
						if(messageLength <= 160){
							// Masih satu karakter
							numberOfSMS = 1;
						} else {
							numberOfSMS = Math.ceil(messageLength / 152); // segment kalo GSM7 lebih dari 170, akan dipecah per 153 segement
						}
					} else if($('#msgEncoding').val() === 'UCS2'){
						if(messageLength <= 70){
							numberOfSMS = 1;
						} else {
							numberOfSMS = Math.ceil(messageLength / 66); // segment kalo UCS2 lebih dari 70, akan dipecah per 67 segement
						}
					}
					console.log('messageLength: ' + messageLength + ', numberOfSMS: ' + numberOfSMS);
					$('#numberOfSMS').val(numberOfSMS);
				};

				$('#divMessageLength').html('<span style="font-size:12px;color:#EA4335">Message length: ' + messageLength + ', Number of SMS: <b>' + numberOfSMS + '</b></span>');
			});		
			
			$('#msgEncoding').on('change', function(){
				var theEncoding = $('#msgEncoding').val().trim();

				// Manage the message Length
				var messageLength = getLengthGSM7(editor.getText().trim());				
				var numberOfSMS = Math.ceil(messageLength / 66); // Default
				console.log('messageLength: ' + messageLength + ', numberOfSMS: ' + numberOfSMS);

				var theText = editor.getText().trim();
				if(theEncoding === 'GSM7'){
					var isGSMA = isGSMAlphabet(theText);

					if(isGSMA === false){
						alert("Your text is NOT GSM7 Character. Please use UCS2 instead.");

						// Reset all the text to empty
						editor.deleteText(0, editor.getLength(), "api");
					}

					if(messageLength <= 160){
						// Masih satu karakter
						numberOfSMS = 1;
					} else {
						numberOfSMS = Math.ceil(messageLength / 152); // segment kalo GSM7 lebih dari 170, akan dipecah per 153 segement
					}
				} else if(theEncoding === 'UCS2'){
					if(messageLength <= 70){
						numberOfSMS = 1;
					} else {
						numberOfSMS = Math.ceil(messageLength / 66); // segment kalo UCS2 lebih dari 70, akan dipecah per 67 segement
					}
				}
				//console.log('messageLength: ' + messageLength + ', numberOfSMS: ' + numberOfSMS);
								// Cut text per limit max 2 sms
				var limit = 132;
				if($('#msgEncoding').val() === 'UCS2'){
					limit = 132;
				} else if($('#msgEncoding').val() === 'GSM7'){
					limit = 304;
				}
				
				if(editor.getLength() > limit){
					editor.deleteText(limit, editor.getLength(), "api");
					alert('Maximum sms is ' + limit + ' characters.');
					messageLength = getLengthGSM7(editor.getText().trim());
					if($('#msgEncoding').val() === 'GSM7'){
						if(messageLength <= 160){
							// Masih satu karakter
							numberOfSMS = 1;
						} else {
							numberOfSMS = Math.ceil(messageLength / 152); // segment kalo GSM7 lebih dari 170, akan dipecah per 153 segement
						}
					} else if($('#msgEncoding').val() === 'UCS2'){
						if(messageLength <= 70){
							numberOfSMS = 1;
						} else {
							numberOfSMS = Math.ceil(messageLength / 66); // segment kalo UCS2 lebih dari 70, akan dipecah per 67 segement
						}
					}
					console.log('messageLength: ' + messageLength + ', numberOfSMS: ' + numberOfSMS);
					$('#numberOfSMS').val(numberOfSMS);
				};
				
				$('#divMessageLength').html('<span style="font-size:12px;color:#EA4335">Message length: ' + messageLength + ', Number of SMS: <b>' + numberOfSMS + '</b></span>');
			})
			
			$('#saveMessage').click(function(e){
				e.preventDefault();
				if($('#numberOfSMS').val() > 2){
					alert('Maximum number of SMS per sending is 2. Your message has ' + $('#numberOfSMS').val() + ' sms. Please reduce it before sending it.');
				} else {
					var theMessage = editor.getText().trim();
					if(theMessage.length > 0){
						// Save to database
						e.preventDefault();

						var form_data = new FormData();
						form_data.append('message', theMessage);
						form_data.append('messageLength', getLengthGSM7(theMessage));
						form_data.append('batchId', $('#uuid').val());
						form_data.append('encoding', $('#msgEncoding').val());
						form_data.append('fileName', $('#fileName').val());
						form_data.append('messageCount', $("#counter").val());
						form_data.append('prefix', $("#CountryCode").val());
						form_data.append('jck', '801fbf1916c335d616903bf6c6710fea434254a0');

						$.ajax({
							type: 'POST',
							url: '../lib/AutoGeneratedANumberSaveN.php',
							data: form_data,
							contentType: false,
							cache: false,
							processData:false,
							success: function(msg){
								console.log('save msg hehe: ' + msg);

								if(msg == '0'){
									console.log('msg is 0');

									// Freeze all controls and move to next step
									//$('#validatedCustomFile').attr('disabled', 'disabled');
									//$('#buttonUpload').attr('disabled', 'disabled');
									//$('#buttonGenerateANumber').attr('disabled', 'disabled');
									//$('#msgEncoding').attr('disabled', 'disabled');
									//$('#saveMessage').attr('disabled', 'disabled');

									// Show modal
									$('#sendingConfirmation').modal('toggle');
									$('#sendingConfirmation').modal('show');
								} else if (msg.startsWith('rld')){
									window.parent.location.reload();	   
								} else {
									console.log('msg is NOT 0');
								}				
							},
							error: function (xhr, ajaxOptions, thrownError) {
								window.parent.location.reload();
							}
						});	
					};					
				};
			});
		
			$('#sendingConfirmation').on('show.bs.modal', function (event) {
				var batch_id = $("#uuid").val();
				var form_data = new FormData();
				form_data.append("batch_id", batch_id);
				form_data.append("jck", '801fbf1916c335d616903bf6c6710fea434254a0');

					$.ajax({
						type: 'POST',
						url: '../lib/AutoGeneratedANumberConfirmation.php',
						data: form_data,
						contentType: false,
						cache: false,
						processData:false,
						success: function(msg){
							//console.log("tobeconfimed message: " + msg);

							if (msg.startsWith('rld')){
								window.parent.location.reload();	   
							} else {
								var jsonResult = JSON.parse(msg);

								console.log("tobeconfimed message: " + jsonResult);

								if(jsonResult['status'] == -1){
									console.log('Error: ' + jsonResult['error']);
								} else {
									$('#ABNumberList').val($('#textMSISDNList').val());

									$('#SentMessage').val(jsonResult[0]['message']);

									$('#PropMessage').val('Message length: ' + jsonResult[0]['length'] + '.\nNo. of MSISDN: ' + jsonResult[0]['noMSISDN'] + '.\nNo. of SMS (per sending): '+ jsonResult[0]['noSMSEach'] + '.\nNo. of Total SMS sent: ' + jsonResult[0]['noSMSTotal']);
								}
							} 
						},
						error: function (xhr, ajaxOptions, thrownError) {
							window.parent.location.reload();
						}
					});		
			});		
			
		});	
	</script>
	
	<script>
		$('#buttonUpload').click(function(e){
			e.preventDefault();
			//alert($('#labelCustomFile').text());
			if($('#labelCustomFile').text() == 'Choose B# number file.'){
				alert('Upload your B# list.');
			} else {
				var file_data = $("#validatedCustomFile").prop("files")[0];   
				var form_data = new FormData();
				form_data.append("file", file_data);
				form_data.append("jck", '801fbf1916c335d616903bf6c6710fea434254a0');
				
				$.ajax({
					type: 'POST',
					url: '../lib/AutoGeneratedANumberSMSUploader.php',
					data: form_data,
					contentType: false,
					cache: false,
					processData:false,
					success: function(msg){
						//console.log('Upload msg: ' + msg);
						if (msg.startsWith('rld')){
							window.parent.location.reload();	   
						} else if(!msg.startsWith('rld') && (msg != '-1') && (msg != '-2')){
							// NOT ERROR
							//console.log(msg);
							$("#step01").val("DONE");
							
							var jsonMsg = JSON.parse(msg);
							//console.log(jsonMsg.counter);
							//console.log(jsonMsg.textArea);
							
							$("#counter").val(jsonMsg.counter);
							$("#uploadConfirmation").html(jsonMsg.textArea);
							//$('#bNumberList').val(jsonMsg.theText);
							$("#fileName").val(jsonMsg.fileName);
							
							// Enable next step
							$('#smartwizard-arrows-danger').smartWizard("stepState", [1], "enable");
							
						} else if(msg == '-1'){
							$("#step01").val("FAILED");
							$("#uploadConfirmation").html('<span style="font-size:18px;color:#EA4335">File can not be opened. Please check your file format and re-upload.</span>')
						} else if(msg == '-2'){
							$("#step01").val("FAILED");
							$("#uploadConfirmation").html('<span style="font-size:18px;color:#EA4335">Sorry, your file can not be uploaded. Please try again later.</span>')
						} else {
							$("#step01").val("FAILED");
							$("#uploadConfirmation").html('<span style="font-size:18px;color:#EA4335">Sorry, your file can not be uploaded. Please try again later.</span>')
						}					
					},
					error: function (xhr, ajaxOptions, thrownError) {
						window.parent.location.reload();
					}
				});				
			}
		});
		
		$('#buttonGenerateANumber').click(function(e){
			if($("#counter").val() == null || $("#counter").val() == ""){
				$('#counter').val(0);
			}
			//alert($('#counter').val());
			e.preventDefault();
			
			var counter_data = $("#counter").val();   
			var form_data = new FormData();
			form_data.append("counter", counter_data);
			form_data.append("jck", '801fbf1916c335d616903bf6c6710fea434254a0');
			
			$.ajax({
					type: 'POST',
					url: '../lib/AutoGeneratedANumberGenerator.php?CountryCode=' + $("#CountryCode").val(),
					data: form_data,
					contentType: false,
					cache: false,
					processData:false,
					success: function(msg){
						console.log(msg);
						
						if(msg.startsWith('rld')){
							window.parent.location.reload();	   
						} else if(!msg.startsWith('rld') && msg != '-1'){
							// NOT ERROR
							$("#step02").val("DONE");
							
							var jsonMsg = JSON.parse(msg);
							//console.log(jsonMsg.textArea);
							//console.log(jsonMsg.theText);
							
							$("#aNumberConfirmation").html(jsonMsg.textArea);
										
							// Enable next step
							$('#smartwizard-arrows-danger').smartWizard("stepState", [2], "enable");

						} else if(msg == '-1'){
							$("#step02").val("FAILED");
							$("#uploadConfirmation").html('<span style="font-size:18px;color:#EA4335">Failed to generate the B numbers. Try again later.</span>')
						} else {
							$("#step02").val("FAILED");
							$("#uploadConfirmation").html('<span style="font-size:18px;color:#EA4335">Sorry, your file can not be uploaded. Please try again later.</span>')
						}					
					},
					error: function (xhr, ajaxOptions, thrownError) {
						window.parent.location.reload();
					}
			});				
			
		});
		
		$('#btnSendTheMessage').click(function(e){
			console.log("btnSendTheMessage");
			
			var form_data = new FormData();
			form_data.append("batch_id", $('#uuid').val());
			form_data.append("jck", '801fbf1916c335d616903bf6c6710fea434254a0');

			$.ajax({
					type: 'POST',
					url: '../lib/AutoGeneratedANumberConfirm.php',
					data: form_data,
					contentType: false,
					cache: false,
					processData:false,
					success: function(msg){
						console.log(msg);	
						
						
						if(msg.startsWith('rld')){
							window.parent.location.reload();	   
						} else if(msg == '000'){
							alert('Batch ' + $('#uuid').val() + ' is being processed. You can check your sending progress in menu Transaction > SMS Transaction Report or Transaction > Batch Progress.');
							window.location = "/page/SMSTransactionReport.php?j=801fbf1916c335d616903bf6c6710fea434254a0";
						} else {
							alert('Failed to process the batch. Please recheck your upload and do re-upload.');
							location.reload();
						}
						
						// Refresh page
						//location.reload();
					},
					error: function (xhr, ajaxOptions, thrownError) {
						window.parent.location.reload();
					}
			})
		})
	</script>
	
	<script>
    	$('#validatedCustomFile').on('change',function(){
        	//get the file name
            var fileName = $(this).val();
			// Remove url path if applied
			fileName = fileName.substring(fileName.lastIndexOf('/')+1);
			// Remove file path if applied
			fileName = fileName.substring(fileName.lastIndexOf('\\')+1);               
			//replace the "Choose a file" label
            $(this).next('.custom-file-label').html(fileName);
		})		
	</script>
		
	
	<script>
		document.addEventListener("DOMContentLoaded", function(event) {
			$('#smartwizard-default-primary').smartWizard({
				theme: 'default',
				keyNavigation: false,
				showStepURLhash: false
			});

			$('#smartwizard-default-success').smartWizard({
				theme: 'default',
				keyNavigation: false,
				showStepURLhash: false
			});

			$('#smartwizard-default-danger').smartWizard({
				theme: 'default',
				keyNavigation: false,
				showStepURLhash: false
			});

			$('#smartwizard-default-warning').smartWizard({
				theme: 'default',
				keyNavigation: false,
				showStepURLhash: false
			});

			$('#smartwizard-arrows-primary').smartWizard({
				theme: 'arrows',
				keyNavigation: false,
				showStepURLhash: false
			});

			$('#smartwizard-arrows-success').smartWizard({
				theme: 'arrows',
				keyNavigation: false,
				showStepURLhash: false
			});

			$('#smartwizard-arrows-danger').smartWizard({
				theme: 'arrows',
				keyNavigation: false,
				showStepURLhash: false
			});

			$('#smartwizard-arrows-warning').smartWizard({
				theme: 'arrows',
				keyNavigation: false,
				showStepURLhash: false
			});

			// Validation
			var $validationForm = $('#smartwizard-validation');

			$validationForm.validate({
				errorPlacement: function errorPlacement(error, element) {
					$(element).parents('.form-group').append(
						error.addClass('invalid-feedback small d-block')
					)
				},

				highlight: function(element) {
					$(element).addClass('is-invalid');
				},

				unhighlight: function(element) {
					$(element).removeClass('is-invalid');
				},

				rules: {
					'wizard-confirm': {
						equalTo: 'input[name="wizard-password"]'
					}
				}

			});

			$validationForm
				.smartWizard({
					autoAdjustHeight: false,
					backButtonSupport: false,
					useURLhash: false,
					showStepURLhash: false,
					keyNavigation: false,
					toolbarSettings: {
						toolbarExtraButtons: [$('<button class="btn btn-submit btn-primary" type="button">Finish</button>')]
					}
				})

				.on('leaveStep', function(e, anchorObject, stepNumber, stepDirection) {
					if (stepDirection === 'forward') {
						return $validationForm.valid();
					}

					return true;
				});

			$validationForm.find('.btn-submit').on('click', function() {
				if (!$validationForm.valid()) {
					return;
				}

				alert("Great! The form is valid and ready to submit.");

				return false;
			});
		});
		
	</script>
	
</body>
</html>	

